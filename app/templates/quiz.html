{% extends 'base.html' %}

{% block content %}
{% if request.user.is_authenticated %}

<div id="app" class="container mt-5 pt-5">
    <div class="col-md-6 mx-auto">
        <div class="card">
            <div class="card-body">
                <h3 class="card-title text-center">{{ quiz_title }}</h3>
                <!-- Loop through questions -->
                <div v-for="question in questions" :key="question.uid" class="mt-4">
                    <div class="card">
                        <div class="card-body">
                            <p class="card-text">[[question.question]]</p>
                            <!-- Loop through answers -->
                            <div class="form-check" v-for="(answer, index) in question.answer" :key="index">
                                <!-- Radio button for selecting an answer -->
                                <input
                                    @change="checkAnswer($event, question.uid)"
                                    :value="answer.answer"
                                    class="form-check-input"
                                    :id="'answer-' + question.uid + '-' + index"
                                    :name="'question-' + question.uid"
                                    type="radio">
                                <label class="form-check-label" :for="'answer-' + question.uid + '-' + index">
                                    [[answer.answer]]
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/vue@3.0.0-rc.5/dist/vue.global.prod.js"></script>
<script>
    Vue.createApp({
        delimiters: ['[[', ']]'],
        data() {
            return {
                category: '{{ category }}', // Initialize category from Django template
                questions: [] // Initialize questions array
            }
        },
        methods: {
            getQuestions() {
                fetch(`/quiz/api/get-quiz/?category=${this.category}`)
                    .then(response => response.json())
                    .then(result => {
                        this.questions = result.data;
                    })
                    .catch(error => {
                        console.error('Error fetching questions:', error);
                    });
            },
            checkAnswer(event, questionUid) {
                const question = this.questions.find(q => q.uid === questionUid);
                const selectedAnswer = question.answer.find(a => a.answer === event.target.value);
                if (selectedAnswer.is_correct) {
                    console.log('Your answer is correct!');
                    alert("Hurray, your answer is correct!");
                } else {
                    console.log('Your answer is wrong!');
                    alert("Better luck next time!");
                }
            }
        },
        created() {
            this.getQuestions(); // Fetch questions when component is created
        }
    }).mount('#app');
</script>
<div class="card" style="margin-top: 70px;">
</div>
{% else %}
<div class="text-center h3" style="margin-top: 70px;">Please log in to access the quiz.</div>
{% endif %}
{% endblock %}
